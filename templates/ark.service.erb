[Unit]
Description=<%= @node['ark']['gameserver']['configuration']['SessionSettings']['SessionName'] %>
Wants=network-online.target
After=syslog.target network.target nss-lookup.target network-online.target

[Service]
ExecStartPre=<%= @node['steam']['steamcmd']['install_dir'] %>/steamcmd.sh +login anonymous +force_install_dir <%= @node['ark']['install_dir'] %>/<%= @node['ark']['appid'] %> +app_update <%= @node['ark']['appid'] %> +quit
ExecStart=<%= @node['ark']['install_dir'] %>/<%= @node['ark']['appid'] %>/ShooterGame/Binaries/Linux/ShooterGameServer <%= @node['ark']['gameserver']['configuration']['map'] %>?listen?MaxPlayers=<%= @node['ark']['gameserver']['configuration']['MaxPlayers'] %>?Port=<%= @node['ark']['gameserver']['configuration']['ListenPort'] %>?QueryPort=<%= @node['ark']['gameserver']['configuration']['QueryPort'] %><% if @node['ark']['gameserver']['configuration']['EnableRcon'] %>?RCONEnabled=True?RCONPort=<%= @node['ark']['gameserver']['configuration']['ServerSettings']['RCONPort'] %><% else %>?RCONEnabled=False<% end %>?ServerAdminPassword=<%= @node['ark']['gameserver']['configuration']['ServerSettings']['ServerAdminPassword'] %>?ServerPassword=<%= @node['ark']['gameserver']['configuration']['ServerSettings']['ServerPassword'] %><% if @node['ark']['gameserver']['configuration']['battleeye'] %> -UseBattlEye<% end %> -server -log
LimitNOFILE=100000
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s INT $MAINPID
User=<%= @node['steam']['user'] %>
Group=<%= @node['steam']['user'] %>

[Install]
WantedBy=multi-user.target
